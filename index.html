<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fort Defense Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-template-rows: repeat(5, 100px);
            gap: 5px;
            margin: 20px 0;
        }
        .cell {
            width: 100px;
            height: 100px;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #aaa;
            cursor: pointer;
            position: relative;
        }
        .fort {
            background-color: #4caf50; /* Green for forts */
            position: relative;
        }
        .turret {
            background-color: #ff9800; /* Orange for turrets */
            position: relative;
        }
        .bullet {
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            transition: transform 0.5s;
        }
        .controls {
            margin-top: 20px;
        }
        .health-bar {
            height: 10px;
            width: 100%;
            background-color: #ccc;
            border: 1px solid #aaa;
            margin: 5px 0;
        }
        .health {
            height: 100%;
            background-color: green;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Fort Defense Game</h1>
        <div class="controls">
            <p>Player 1 Points: <span id="player1Points">12</span></p>
            <p>Player 2 Points: <span id="player2Points">12</span></p>
        </div>
        <div class="board" id="gameBoard"></div>
        <div class="controls">
            <button id="attack" disabled>Attack!</button>
            <p id="message"></p>
        </div>
    </div>
    
    <script>
        const board = document.getElementById('gameBoard');
        const messageDisplay = document.getElementById('message');
        const attackButton = document.getElementById('attack');
        const player1PointsDisplay = document.getElementById('player1Points');
        const player2PointsDisplay = document.getElementById('player2Points');
        const gridSize = 5;
        let currentPlayer = 1;
        let playerFortHealth = [10, 10]; // Health for player 1 and 2 forts
        let turretHealth = [3, 3]; // Health for turrets
        let turrets = [[], []]; // Array to hold turret positions
        let playerPoints = [12, 12]; // Points for each player
        let boardState = Array(gridSize).fill().map(() => Array(gridSize).fill(null));
        let attackInterval; // Interval for turret attacks
        let canAttack = false; // Track if players can attack

        // Place forts automatically on the left and right
        const fort1 = { row: 2, col: 0, health: playerFortHealth[0] };
        const fort2 = { row: 2, col: gridSize - 1, health: playerFortHealth[1] };
        boardState[fort1.row][fort1.col] = 'Fort1';
        boardState[fort2.row][fort2.col] = 'Fort2';

        // Initialize the game board
        for (let i = 0; i < gridSize; i++) {
            for (let j = 0; j < gridSize; j++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.row = i;
                cell.dataset.col = j;
                cell.addEventListener('click', () => handleCellClick(i, j));
                board.appendChild(cell);
            }
        }

        // Function to display health bars
        function updateHealthBars() {
            const cells = document.querySelectorAll('.cell');
            cells.forEach(cell => {
                const row = cell.dataset.row;
                const col = cell.dataset.col;
                cell.textContent = boardState[row][col] || '';
                cell.classList.remove('fort', 'turret');
                if (boardState[row][col] === 'Fort1') {
                    cell.classList.add('fort');
                    cell.innerHTML += `<div class="health-bar"><div class="health" style="width: ${(playerFortHealth[0] * 10)}%;"></div></div>`;
                } else if (boardState[row][col] === 'Fort2') {
                    cell.classList.add('fort');
                    cell.innerHTML += `<div class="health-bar"><div class="health" style="width: ${(playerFortHealth[1] * 10)}%;"></div></div>`;
                } else if (cell.textContent.startsWith('Turret')) {
                    cell.classList.add('turret');
                    cell.innerHTML += `<div class="health-bar"><div class="health" style="width: ${(turretHealth[currentPlayer - 1] * 33.33)}%;"></div></div>`;
                }
            });
        }

        function handleCellClick(row, col) {
            if (boardState[row][col] === null) {
                if (canPlaceTurret(row, col)) {
                    if (playerPoints[currentPlayer - 1] >= 3) {
                        boardState[row][col] = `Turret${currentPlayer}`;
                        turrets[currentPlayer - 1].push({ row, col });
                        playerPoints[currentPlayer - 1] -= 3; // Deduct points for placing a turret
                        updateHealthBars();
                        checkAttackStatus(); // Check if both players can attack
                        endTurn(); // End the turn after placing a turret
                    } else {
                        messageDisplay.textContent = 'Not enough points to place a turret!';
                    }
                } else {
                    messageDisplay.textContent = 'Turrets can only be placed adjacent to your structures!';
                }
            } else {
                messageDisplay.textContent = 'Cell already occupied!';
            }
        }

        function canPlaceTurret(row, col) {
            // Check if the cell is adjacent to any of the player's existing structures (forts or turrets)
            const adjacentCells = [
                { r: row - 1, c: col }, { r: row + 1, c: col },
                { r: row, c: col - 1 }, { r: row, c: col + 1 }
            ];
            return adjacentCells.some(cell => {
                const { r, c } = cell;
                return r >= 0 && r < gridSize && c >= 0 && c < gridSize &&
                    (boardState[r][c] && boardState[r][c].startsWith(`Turret${currentPlayer}`) || boardState[r][c] === `Fort${currentPlayer}`);
            });
        }

        function checkAttackStatus() {
            // Enable attack button only if both players have at least one turret
            if (turrets[0].length > 0 && turrets[1].length > 0) {
                canAttack = true;
                attackButton.disabled = false;
            }
        }

        function endTurn() {
            // Check if the current player has no points
            if (playerPoints[currentPlayer - 1] <= 0) {
                messageDisplay.textContent = `Player ${currentPlayer} has no points! Skipping turn.`;
                currentPlayer = currentPlayer === 1 ? 2 : 1; // Switch to the other player
                if (playerPoints[currentPlayer - 1] > 0) {
                    messageDisplay.textContent = `Player ${currentPlayer}'s turn.`;
                } else {
                    messageDisplay.textContent = `Both players have no points! Game over.`;
                    clearInterval(attackInterval);
                }
                return;
            }

            // Start turret attacks if both players can attack
            if (canAttack) {
                clearInterval(attackInterval);
                attackInterval = setInterval(() => {
                    turrets.forEach((turretArray, playerIndex) => {
                        turretArray.forEach(turret => {
                            const target = findTarget(playerIndex);
                            if (target) {
                                attackStructure(target.row, target.col, playerIndex);
                            }
                        });
                    });
                }, 2000); // Attack every 2 seconds
            }
        }

        function findTarget(playerIndex) {
            // Determine the nearest target structure, prioritizing the fort
            const opponentIndex = playerIndex === 0 ? 1 : 0;
            let fortTarget = null;
            let turretTarget = null;

            // Check if the opponent's fort is within range
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (boardState[i][j] === `Fort${opponentIndex + 1}`) {
                        fortTarget = { row: i, col: j };
                        break;
                    }
                }
                if (fortTarget) break;
            }

            // If the fort isn't found or if it's not in range, look for turrets
            if (fortTarget) {
                return fortTarget;
            } else {
                for (let i = 0; i < gridSize; i++) {
                    for (let j = 0; j < gridSize; j++) {
                        if (boardState[i][j] && boardState[i][j].startsWith(`Turret${opponentIndex + 1}`)) {
                            turretTarget = { row: i, col: j };
                            break;
                        }
                    }
                    if (turretTarget) break;
                }
            }

            return turretTarget;
        }

        function attackStructure(row, col, playerIndex) {
            // Create a bullet and animate it
            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            const turretCell = document.querySelector(`.cell[data-row="${turrets[playerIndex][0].row}"][data-col="${turrets[playerIndex][0].col}"]`);
            turretCell.appendChild(bullet);

            const targetCell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            const targetRect = targetCell.getBoundingClientRect();
            const turretRect = turretCell.getBoundingClientRect();

            const dx = targetRect.left - turretRect.left;
            const dy = targetRect.top - turretRect.top;

            bullet.style.transform = `translate(${dx}px, ${dy}px)`;

            setTimeout(() => {
                bullet.remove();
                // Damage the target
                if (boardState[row][col] === 'Fort1' && playerIndex === 0) {
                    playerFortHealth[0]--;
                    damageAdjacentStructures(row, col, playerIndex);
                    if (playerFortHealth[0] <= 0) {
                        messageDisplay.textContent = 'Player 2 wins!';
                        clearInterval(attackInterval);
                    }
                } else if (boardState[row][col] === 'Fort2' && playerIndex === 1) {
                    playerFortHealth[1]--;
                    damageAdjacentStructures(row, col, playerIndex);
                    if (playerFortHealth[1] <= 0) {
                        messageDisplay.textContent = 'Player 1 wins!';
                        clearInterval(attackInterval);
                    }
                } else if (boardState[row][col].startsWith('Turret')) {
                    turretHealth[opponentIndex]--; // Reduce turret health
                    if (turretHealth[opponentIndex] <= 0) {
                        boardState[row][col] = null; // Destroy the turret
                        playerPoints[opponentIndex] += 3; // Reward points
                    }
                }
                updateHealthBars();
            }, 500);
        }

        function damageAdjacentStructures(row, col, playerIndex) {
            const directions = [
                { dr: 0, dc: 1 }, // Right
                { dr: 0, dc: -1 }, // Left
                { dr: 1, dc: 0 }, // Down
                { dr: -1, dc: 0 }  // Up
            ];

            directions.forEach(({ dr, dc }) => {
                for (let distance = 1; distance <= 3; distance++) {
                    const r = row + dr * distance;
                    const c = col + dc * distance;
                    if (r >= 0 && r < gridSize && c >= 0 && c < gridSize) {
                        if (boardState[r][c] && boardState[r][c].startsWith('Fort')) {
                            const opponentIndex = playerIndex === 0 ? 1 : 0;
                            playerFortHealth[opponentIndex]--; // Damage the opponent's fort
                        } else if (boardState[r][c] && boardState[r][c].startsWith('Turret')) {
                            const opponentIndex = playerIndex === 0 ? 1 : 0;
                            turretHealth[opponentIndex]--; // Damage the turret
                        }
                    }
                }
            });
        }

        updateHealthBars(); // Initial health bar update
    </script>
</body>
</html>
